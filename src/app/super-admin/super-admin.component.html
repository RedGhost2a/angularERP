<div class="big-container">

  <h1 class="title"  data-step="1" data-title="Bienvenue !<br> üëã " data-intro=" Vous √©tes sur la page Administration, cet espace vous permet d'acc√©der √† diff√©rentes fonctionnalit√©s associ√©es √† la gestion de votre entreprise !">Administration </h1>
  <mat-tab-group mat-stretch-tabs>


    <mat-tab>
      <ng-template mat-tab-label  >
        <mat-icon class="example-tab-icon">settings</mat-icon>
        Param√®tres
      </ng-template>
      <h3 class="bold" >Options d'administration</h3>
      <div class="global-container">
        <mat-icon  (click)="startIntro()" class=" iconInfo">info</mat-icon>

        <p *ngIf="showInfo" class="pInfo">
          Bienvenue sur la page de gestion des entreprises. Cet espace vous permet d'acc√©der √† diff√©rentes fonctionnalit√©s associ√©es √† la gestion de votre entreprise :

          1. <strong>Ajouter une entreprise</strong> : Cliquez sur le bouton  <mat-icon class="icn">add</mat-icon> pour enregistrer une nouvelle entreprise dans le syst√®me.<br>
          2. <strong>Liste des devis</strong> : Cliquez sur l'ic√¥ne<mat-icon class="icn">list</mat-icon> pour acc√©der √† la liste compl√®te de tous les devis enregistr√©s.<br>
          3. <strong>Ajouter un utilisateur</strong> : Cliquez sur l'ic√¥ne<mat-icon class="icn">create</mat-icon> pour ajouter un nouvel utilisateur √† une entreprise.<br>
          4. <strong>Importer des donn√©es</strong> : Utilisez l'option <mat-icon class="icn"> import_export</mat-icon> pour importer des donn√©es pertinentes pour votre entreprise √† partir d'un fichier externe.<br>
          5. <strong>Cr√©er une unit√©</strong> : Cliquez sur <mat-icon class="icn">playlist_add</mat-icon> pour cr√©er et enregistrer une nouvelle unit√© pour votre entreprise.<br>

          Naviguez √† travers ces options pour g√©rer efficacement les informations de votre entreprise.
        </p>

        <div class="card ">

          <div class="flex-row"  >
            <button class="btn blue" (click)="updateCompany(null)" data-step="2" data-intro="Cliquez sur le bouton  pour enregistrer une nouvelle entreprise dans le syst√®me.">
              <mat-icon class="icn">add</mat-icon>
              <p class="paramP">Ajouter une entreprise</p>
            </button>



          <div class="" data-step="3" data-intro="Cliquez ici pour acc√©der √† la liste compl√®te de tous les devis enregistr√©s.">
            <button class="btn green" [routerLink]="'/devis/'">
              <mat-icon class="icn">list</mat-icon>
              <p class="paramP">Liste des devis</p>
            </button>
          </div>
          </div>

          <div class="flex-row">
            <button class="btn yellow" (click)="openDialogCreate(null)" data-step="4" data-intro="Ici pour ajouter un nouvel utilisateur √† une entreprise.">
              <mat-icon class="icn">create</mat-icon>
              <p class="paramP">Ajouter un utilisateur</p>
            </button>


          <div class="">
            <button class="btn orange" (click)="openImportDialog()" data-step="5" data-intro="Utilisez ce bouton pour importer des donn√©es pertinentes pour votre entreprise √† partir d'un fichier externe.<br>* Vos donn√©es dans voter fichier Excel doivent respecter un certain format">
              <mat-icon class="icn"> import_export</mat-icon>
              <p class="paramP">Importer des donn√©es</p>
            </button>

          </div>
          </div>

          <div class="flex-row">
            <button class="btn pink" (click)="openUniteForFormDialog()" data-step="6" data-intro=" Et enfin cliquez ici  pour cr√©er et enregistrer une nouvelle unit√© pour votre entreprise. Ces unit√©s sont n√©cessaires a la cr√©ation de donn√©es dans vos diff√©rentes biblioth√®ques">
              <mat-icon class="icn">playlist_add</mat-icon>
              <p class="paramP">Cr√©er une unit√©</p>
            </button>

          </div>

        </div>


      </div>
    </mat-tab>


    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon class="example-tab-icon">business</mat-icon>
        Gestion des entreprises
      </ng-template>
      <h3 class="bold" >Gestion des entreprises </h3>
      <div class="global-container">
          <mat-icon  (click)="toggleInfo()" class=" iconInfo">info</mat-icon>

        <p *ngIf="showInfo" class="pInfo">
          Bienvenue √† la page de gestion des entreprises. Ici, vous pouvez consulter et g√©rer l'ensemble de vos entreprises enregistr√©es. En s√©lectionnant une entreprise sp√©cifique, vous pourrez acc√©der aux d√©tails de celle-ci, comme la gestion des devis, des utilisateurs et des clients associ√©s. Explorez et profitez des fonctionnalit√©s !
        </p>

        <table mat-table
               [dataSource]="dataSourceEntreprise"   >

          <ng-container matColumnDef="nEntreprise">
            <th mat-header-cell *matHeaderCellDef>N¬∞</th>
            <td routerLink="/admin/entreprise/{{entreprise.id}}" mat-cell
                *matCellDef="let entreprise">{{entreprise.id}}</td>
          </ng-container>
          <ng-container matColumnDef="commercialName">
            <th mat-header-cell *matHeaderCellDef>Nom commercial</th>
            <td routerLink="/admin/entreprise/{{entreprise.id}}" mat-cell
                *matCellDef="let entreprise">{{entreprise.commercialName}}</td>
          </ng-container>

          <!-- Weight Column -->
          <ng-container matColumnDef="denomination">
            <th mat-header-cell *matHeaderCellDef>D√©nomination</th>
            <td routerLink="/admin/entreprise/{{entreprise.id}}" mat-cell
                *matCellDef="let entreprise">{{entreprise.denomination}}</td>
          </ng-container>

          <ng-container matColumnDef="siret">
            <th mat-header-cell *matHeaderCellDef> Siret</th>
            <td routerLink="/admin/entreprise/{{entreprise.id}}" mat-cell
                *matCellDef="let entreprise">{{entreprise.siret}}</td>
          </ng-container>

          <ng-container matColumnDef="phoneNumber">
            <th mat-header-cell *matHeaderCellDef> T√©l√©phone</th>
            <td routerLink="/admin/entreprise/{{entreprise.id}}" mat-cell
                *matCellDef="let entreprise">{{entreprise.phoneNumber}} </td>
          </ng-container>

          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef> Action</th>
            <td  mat-cell
                *matCellDef="let entreprise">
              <button  mat-flat-button color="warn" (click)="delete(entreprise.id)" style="margin-right: 5px">  Supprimer</button>
              <button  mat-flat-button color="primary" (click)="updateCompany(entreprise.id)">  Modifier</button>
            </td>
          </ng-container>


          <tr mat-header-row *matHeaderRowDef="displayedColumnsEntreprise"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsEntreprise;">
          </tr>

        </table>
      </div>
    </mat-tab>


    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon class="example-tab-icon">sticky_note_2</mat-icon>
        Gestion des tickets
      </ng-template>
      <h3 class="bold">Liste des tickets inter-entreprises</h3>

<div  class="flex-row">
  <mat-icon  (click)="startIntro()" class=" iconInfo">info</mat-icon>
  <p *ngIf="showInfo" class="pInfo">
    Bienvenue dans la section de <strong >Gestion de tickets</strong>. Cette interface pr√©sente vos tickets inter-entreprises sous forme de cartes color√©es.<br>

    <strong style="color: red">Cartes Rouges</strong> : Repr√©sentent les erreurs rencontr√©es. Chaque carte affiche le titre, la date de cr√©ation et un insigne indiquant la pr√©sence de logs d'erreurs.<br>

    <strong style="color: #00a9f4">Cartes Bleues</strong> : Signalent les suggestions ou demandes des utilisateurs pour am√©liorer le site. Elles portent le titre du ticket, le type de demande et la date de cr√©ation.<br>

    Sur chaque carte, vous pouvez marquer un ticket comme r√©solu ou le supprimer si n√©cessaire. Utilisez ces fonctionnalit√©s pour g√©rer efficacement vos tickets.
  </p>
  <div *ngFor="let note of this.notes;" class="card-ticket">
    <mat-card [ngClass]="{'error-note': note.typeError === 'J\'ai rencontr√© une erreur !', 'suggestion-note': note.typeError === 'J\'ai une demande / suggestion !'}">
      <mat-card-header>
        <mat-card-title>{{note.title|uppercase}}</mat-card-title>
        <mat-card-subtitle>{{note.typeError}} {{note?.optionsTypeError}}</mat-card-subtitle>
        <mat-card-subtitle>Le: {{note.createdAt | date:'dd/MM/yyyy HH:mm:ss'}}</mat-card-subtitle>
        <mat-card-subtitle *ngIf="note.errorLogs && note.errorLogs.length > 0" matBadge="!" matBadgePosition="before"
                           matBadgeColor="accent" matBadgeOverlap="false">Log
        </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <p>Sujet:<br>  {{note.text|uppercase}}</p>
        <div *ngFor="let log of note.errorLogs;">
          <p>{{log.message}}</p>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <div class="flex-row"  style="justify-content: space-around">
          <mat-checkbox [(ngModel)]="note.resolution" *ngIf=" note.typeError === 'J\'ai rencontr√© une erreur !'" (change)="onNoteResolutionChanged(note)" style="font-size: 16px">R√©solu !</mat-checkbox>
          <button mat-flat-button color="warn" (click)="deleteItem(note.id)">Supprimer</button>
        </div>
      </mat-card-actions>
    </mat-card>
  </div>

</div>

    </mat-tab>

    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon class="example-tab-icon">error</mat-icon>
        Gestion des erreurs
      </ng-template>
      <h3 class="bold">Gestion des erreurs inter-entreprises</h3>
      <div class="container">
        <mat-icon  (click)="toggleInfo()" class=" iconInfo">info</mat-icon>

        <p *ngIf="showInfo" class="pInfo">
          Vous vous trouvez actuellement sur l'onglet de <strong>Gestion des erreurs</strong>. Cet espace vous permet de consulter et de g√©rer les erreurs survenues.


          Utilisez ces fonctionnalit√©s pour assurer un suivi efficace des erreurs .
        </p>

        <mat-form-field>
          <mat-label>Recherche d'une erreur</mat-label>
          <input matInput (keyup)="applyFilter($event)" placeholder="Ex. ge..." #input>
        </mat-form-field>
        <mat-paginator #paginator2 style="width: 100%" [pageSize]="10" [pageSizeOptions]="[5, 10, 20,100]"
                       showFirstLastButtons
                       aria-label="Selectionner page de logs">
        </mat-paginator>

        <table #table mat-table [dataSource]="dataSource2"
               style="width: 100%;text-align: justify-all">

          <ng-container matColumnDef="Id">
            <th mat-header-cell *matHeaderCellDef> No.</th>
            <td style="color: blue" mat-cell *matCellDef="let element"> {{element.id}} </td>
          </ng-container>

          <ng-container matColumnDef="Level">
            <th mat-header-cell *matHeaderCellDef> Level</th>
            <td mat-cell *matCellDef="let element"> {{element.level}} </td>
          </ng-container>

          <ng-container matColumnDef="Type d'erreur">
            <th mat-header-cell *matHeaderCellDef> Nom</th>
            <td mat-cell [ngStyle]="{'color': methodColors[element.name]}"
                *matCellDef="let element"> {{element.name}} </td>
          </ng-container>

          <ng-container matColumnDef="Date">
            <th mat-header-cell *matHeaderCellDef> Date</th>
            <td mat-cell *matCellDef="let element"> {{element.createdAt | date:'dd/MM/yyyy HH:mm:ss'}} </td>
          </ng-container>

          <ng-container matColumnDef="Statut">
            <th mat-header-cell *matHeaderCellDef> Statut</th>
            <td mat-cell *matCellDef="let element"> {{element.status}}</td>
          </ng-container>

          <ng-container matColumnDef="Message">
            <th mat-header-cell *matHeaderCellDef> Message</th>
            <td mat-cell *matCellDef="let element"> {{element.statusText}} </td>
          </ng-container>

          <ng-container matColumnDef="Url">
            <th mat-header-cell *matHeaderCellDef> Url</th>
            <td mat-cell *matCellDef="let element">
              <span *ngIf="element.level === '5'"><a [href]="element?.url">{{ element.url }}</a></span>
            </td>
          </ng-container>

          <ng-container matColumnDef="Utilisateur">
            <th mat-header-cell *matHeaderCellDef> User</th>
            <td mat-cell
                *matCellDef="let element">  {{element.UserId}} </td>
          </ng-container>

          <ng-container matColumnDef="Dur√©e">
            <th mat-header-cell *matHeaderCellDef> Dur√©e</th>
            <td mat-cell [style.color]="getDurationColor(element.duration)"
                *matCellDef="let element">  {{element.duration}} ms
            </td>
          </ng-container>

          <ng-container matColumnDef="D√©tails">
            <th mat-header-cell *matHeaderCellDef> D√©tails</th>
            <td mat-cell
                *matCellDef="let element">
              <mat-icon color="primary" *ngIf="element?.level==='6'" matTooltip="{{ element?.method }}">info</mat-icon>
              <mat-icon color="primary" *ngIf="element?.level==='5'" matTooltip="{{ element?.message }}">info</mat-icon>
            </td>
          </ng-container>


          <tr mat-header-row *matHeaderRowDef="displayedColumns2"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns2;"></tr>
        </table>

      </div>
    </mat-tab>


    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon class="example-tab-icon">settings</mat-icon>
        Gestion des imports
      </ng-template>
      <h3 class="bold">Liste des imports/exports</h3>

      <div class="wrapper-bis">
        <mat-icon  (click)="toggleInfo()" class=" iconInfo">info</mat-icon>

        <p *ngIf="showInfo" class="pInfo">
          Bienvenue dans l'onglet de <strong>Gestion des Imports</strong>. Cette section vous offre la possibilit√© d'importer diff√©rents types de fichiers Excel.

          Pour une extraction efficace des donn√©es, vos fichiers Excel doivent respecter une structure sp√©cifique. Cette structure est n√©cessaire que vous importiez des biblioth√®ques de composants, d'ouvrages ou de types. Cet outil permet √©galement d'extraire les fournisseurs.

         <br> Notez bien : si une entr√©e de votre base de donn√©es est d√©j√† pr√©sente, elle ne sera pas ajout√©e lors de l'importation.

          Utilisez cet outil pour assurer uen biblioth√®que en lien avec vos precedents outils.
        </p>
        <div class="flex-column">

          <button style="margin: 5px" mat-raised-button color="primary" (click)="openImportDialog()">Importer des
            donn√©es
          </button>
          <button style="margin: 5px" mat-raised-button color="accent" (click)="importType()">Extraire les
            donn√©es
          </button>
          <div *ngIf="visible" class="overlay">
            <p class="clignote-text">Chargement en cours...</p>
            <div class="progress-bar-container">
              <div [style.width.%]="progressValue" class="progress-bar"></div>
            </div>
          </div>


        </div>

        <table mat-table [dataSource]="importedFiles" style="width: 33%">
          <ng-container matColumnDef="select">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let file">
              <mat-checkbox [(ngModel)]="file.checked"></mat-checkbox>
            </td>
          </ng-container>
          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef>Nom du fichier</th>
            <td mat-cell *matCellDef="let file">{{ file.title }}</td>
          </ng-container>
          <ng-container matColumnDef="createdAt">
            <th mat-header-cell *matHeaderCellDef>Date d'importation</th>
            <td mat-cell *matCellDef="let file">{{ file.createdAt|date:"dd/MM/yyyy HH:mm" }}</td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="['select', 'title', 'createdAt']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['select', 'title', 'createdAt']"></tr>
        </table>

      </div>
    </mat-tab>


    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon class="example-tab-icon">account_circle</mat-icon>
        Logs
      </ng-template>
      <h3 class="bold">Liste des logs inter-entreprise </h3>
      <div class="container">
        <mat-icon  (click)="toggleInfo()" class=" iconInfo">info</mat-icon>

        <p *ngIf="showInfo" class="pInfo">
          Vous vous trouvez actuellement sur l'onglet de <strong>Gestion des logs</strong>. Cet espace vous permet de consulter et de g√©rer tout les logs concernant votre application.


          Utilisez ces fonctionnalit√©s pour assurer un suivi efficace. .
        </p>
        <mat-form-field>
          <mat-label>Recherche d'un log</mat-label>
          <input matInput (keyup)="applyFilter($event)" placeholder="Ex. POST..." #input>
        </mat-form-field>
        <mat-paginator #paginator style="width: 100%" [pageSize]="10" [pageSizeOptions]="[5, 10, 20,100]"
                       showFirstLastButtons
                       aria-label="S√©l√©ctionner page de logs">
        </mat-paginator>

        <table #table matSort mat-table [dataSource]="dataSource"
               style="width: 100%;text-align: justify-all">


          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef> No.</th>
            <td style="color: blue" mat-cell *matCellDef="let element"> {{element.id}} </td>
          </ng-container>

          <ng-container matColumnDef="level">
            <th mat-header-cell *matHeaderCellDef> Level</th>
            <td mat-cell *matCellDef="let element"> {{element.level}} </td>
          </ng-container>

          <ng-container matColumnDef="method">
            <th mat-header-cell *matHeaderCellDef> Method</th>
            <td mat-cell [ngStyle]="{'color': methodColors[element.method]}"
                *matCellDef="let element"> {{element.method}} </td>
          </ng-container>

          <ng-container matColumnDef="createdAt">
            <th mat-header-cell *matHeaderCellDef> Date</th>
            <td mat-cell *matCellDef="let element"> {{element.createdAt | date:'dd/MM/yyyy HH:mm:ss'}} </td>
          </ng-container>

          <ng-container matColumnDef="url">
            <th mat-header-cell *matHeaderCellDef> Url</th>
            <td mat-cell *matCellDef="let element"><a [href]="element.url"> {{element.url}}</a></td>
          </ng-container>

          <ng-container matColumnDef="UserId">
            <th mat-header-cell *matHeaderCellDef> Utilisateurs</th>
            <td mat-cell *matCellDef="let element"> {{element.UserId}} </td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef> Status</th>
            <td style="color: green" mat-cell *matCellDef="let element"> {{element.status}} </td>
          </ng-container>

          <ng-container matColumnDef="duration">
            <th mat-header-cell *matHeaderCellDef> Dur√©e</th>
            <td mat-cell [style.color]="getDurationColor(element.duration)"
                *matCellDef="let element"> {{element.duration}}ms
            </td>
          </ng-container>


          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>


      </div>
    </mat-tab>


  </mat-tab-group>
</div>








