<ng-container *ngIf="dataLoad; else content">
  <mat-spinner></mat-spinner>
</ng-container>

<ng-template #content>

  <mat-tab-group animationDuration="0ms" class="onglet" [(selectedIndex)]="selectedIndex">

    <mat-tab label="Frais de chantier"  *ngIf="lotFraisDeChantier !== undefined" id="tab1" >
      <ng-template mat-tab-label >
<!--        <button mat-raised-button  data-step="1" data-intro="Ici vous retrouverez  la partie frais de chantier pour vos frais annexe neccessaire au calcul de votre etude de prix !"  >-->
          Frais de chantier
<!--        </button>-->
      </ng-template>
      <form [formGroup]="form" (ngSubmit)="onSubmit()" [hidden]="!showForm">
        <mat-form-field appearance="outline" color="primary" >
          <mat-label>Designation</mat-label>
          <input #aForm2 matInput formControlName="designation" placeholder="Entrer le nom."/>
        </mat-form-field>
        <button mat-flat-button type="submit">Valider</button>
      </form>

      <div class="container-frais-chantier">
        <div class="container-card-frais-chantier">
          <div class="text-frais-chantier">
            <h4 class="title-frais-chantier">Chiffrage des frais de chantier</h4>
            <p class="text-frais-chantier">Veuillez ajouter les lots, sous-lots et les ouvrages <br> que vous souhaitez
              afficher dans vos frais de chantier.
            </p>
          </div>


          <mat-card class="card">
            <mat-card-content>
              <div>
                <mat-card-subtitle>Débousé sec HT</mat-card-subtitle>
                <div>
                  <p>{{!this.lotFraisDeChantier.prix ? 0 : this.lotFraisDeChantier.prix| number : '1.2-2'}} €</p>
                </div>
                <mat-card-subtitle>Prix de Vente</mat-card-subtitle>
                <div>
                  <p>{{!this.fraisDeChantier.prixVenteHT ? 0 : this.fraisDeChantier.prixVenteHT | number: '1.2-2'}}
                    €</p>
                </div>
              </div>
            </mat-card-content>
          </mat-card>


        </div>
        <div class="flex-row">

          <div>
            <button class="button"
                    (click)="this.createHiddenSousLotAndOuvrageForFraisDeChantier(lotFraisDeChantier.id )" mat-button
                    color="primary">+ Créer un cout
            </button>
            <!--          <button class="button" (click)="this.openDialogCreateCout()" mat-raised-button color="primary" >Cout</button>-->
          </div>
        </div>

        <div class="container-lot">
          <div class="lot-frais-chantier">
            <span class="designation-lot-frais-chantier">{{ lotFraisDeChantier.id }}</span>
            <span class="designation-lot-frais-chantier">{{ lotFraisDeChantier.designation | titlecase }}</span>
            <span class="designation-lot-frais-chantier">{{ lotFraisDeChantier.prix | number }} €</span>
            <mat-icon [matMenuTriggerFor]="boutonLOT">more_vert</mat-icon>
            <mat-menu #boutonLOT  >
              <div class="menuBoutonSl">
                <button mat-button color="primary" *ngIf="lotFraisDeChantier"
                        (click)="autoFocus2(); isLot = true; curentLotId= lotFraisDeChantier.id">
                  Créer un sous-lot
                </button>
              </div>
            </mat-menu>
          </div>

          <div class="container-sous-lot-frais-chantier" *ngFor="let sublot of lotFraisDeChantier.SousLots">
            <div class="sous-lot-frais-chantier" *ngIf="!sublot.designation.startsWith('SousLotHidden')">
              <button class="btn">
                <mat-icon>expand_more</mat-icon>
                <span class="designation-sous-lot-frais-chantier">{{ sublot.id | number }}</span>
              </button>
              <span
                class="designation-sous-lot-frais-chantier">{{ sublot.designation | uppercase }}</span>
              <span class="designation-sous-lot-frais-chantier"> {{ sublot.prix | number }} €</span>
              <mat-icon [matMenuTriggerFor]="boutonSL">more_vert</mat-icon>
              <!--            </div>-->
              <!--          </div>-->
              <mat-menu #boutonSL>
                <div class="menuBoutonSl">
                  <button (click)="openDialogSousLot(sublot);" mat-button
                          color="primary">
                    Modifier ce sous-lot
                  </button>
                  <br>
                  <button (click)="openDialogFraisDeChantier(sublot.id);currentSousLotId = sublot.id" mat-button
                          color="primary">
                    Importer un ouvrage
                  </button>
                  <br>
                  <button (click)="openDialogCreate(sublot.id);currentSousLotId = sublot.id" mat-button
                          color="primary">
                    <!--          <button (click)="openDialog();handleSousLotClick(sublot.id)" mat-menu-item class="buttonImport">-->
                    Creer un ouvrage
                  </button>
                  <br>
                  <button mat-button color="warn" *ngIf="lotFraisDeChantier"
                          (click)="deleteSousLot(sublot.id)">
                    <!--                  (click)="handleSousLotClick(sublot.id); currentLot = lot; deleteSousLot(sublot.id)">-->
                    Effacer ce sous-lot
                  </button>
                </div>

              </mat-menu>
            </div>
            <div class="container-ouvrage-frais-chantier" *ngFor="let ouvrage of sublot.OuvrageDuDevis"
                 [hidden]="hiddenChildren.get(sublot.id)">
              <div>
                <div class="ouvrage-frais-chantier"
                     *ngIf="ouvrage.SousLotOuvrage && !ouvrage.designation.startsWith('OuvrageHidden')">
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Id</span>
                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.id}}</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Qte</span>
                    <mat-form-field appearance="legacy" [formGroup]="myFormGroup"
                                    id="quantity-ouvrage-frias-de-chantier">
                      <input type="number" formControlName="quantityOuvrage" matInput required
                             [placeholder]="ouvrage.SousLotOuvrage.quantityOuvrage.toString()"
                             (ngModelChange)="quantityChange($event, ouvrage?.SousLotOuvrage, sublot, lotFraisDeChantier, prixOuvrageFraisDeChantier)">
                      <!--                    (ngModelChange)="quantityChange($event, ouvrage?.SousLotOuvrage, sublot, lot, prixOuvrage)">-->

                    </mat-form-field>
                  </div>


                  <div class="detail-ouvrage-frais-chantier" id="designation-ouvrage-fraisDeChantier">
                    <span class="designation-ouvrage-frais-chantier-td">Désignation</span>
                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.designation}}</span>
                  </div>
                  <!--                <div class="detail-ouvrage-frais-chantier">-->
                  <!--                  <span class="designation-ouvrage-frais-chantier-td">Bénéfice</span>-->
                  <!--                  <span class="designation-ouvrage-frais-chantier">{{ouvrage.benefice}}</span>-->
                  <!--                </div>-->
                  <!--                <div class="detail-ouvrage-frais-chantier">-->
                  <!--                  <span class="designation-ouvrage-frais-chantier-td">Aléas</span>-->
                  <!--                  <span class="designation-ouvrage-frais-chantier">{{ouvrage.aleas}}</span>-->
                  <!--                </div>-->
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Unité</span>
                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.unite}}</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">U/Ratio</span>
                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.uRatio}}</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Ratio</span>
                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.ratio}}</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Total DS HT</span>
                    <span
                      class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixOuvrage | number: '1.2-2'}}
                      €</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier" *ngIf="ouvrage.CoutDuDevis">
                    <span class="designation-ouvrage-frais-chantier-td">PU DS HT</span>
                    <span *ngIf="ouvrage.CoutDuDevis.length >= 1"
                          class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixUniHT | number: '1.2-2'}}
                      €
                    </span>
                    <span *ngIf="ouvrage.CoutDuDevis.length === 0"
                          class="designation-ouvrage-frais-chantier">{{ouvrage.prix | number: '1.2-2'}}
                      €</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">PU Vente HT </span>
                    <span
                      class="designation-ouvrage-frais-chantier">
                      <mat-form-field [formGroup]="myFormGroup" id="prix-arrondi-frais-chantier">
                                            <input type="number" formControlName="quantityOuvrage" matInput required

                                                   placeholder="{{ouvrage.SousLotOuvrage.prixUniVenteHT.toString() | number: '1.2-2'}}"
                                                   (ngModelChange)="onPrixUnitaireCalculeHtChange($event, ouvrage.SousLotOuvrage)">
                                          </mat-form-field>
                    </span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Prix Vente HT</span>
                    <span
                      class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixVenteHT | number: '1.2-2'}}
                      €</span>
                  </div>
                  <div>
                  <span class="designation-ouvrage-frais-chantier">
                  <mat-icon [matMenuTriggerFor]="boutonOuv">more_vert</mat-icon>
                <mat-menu #boutonOuv>
                  <div class="menuBoutonSl">
                    <button mat-button color="primary" routerLink="/sousDetailPrix/{{ouvrage.id}}"
                            (click)="onTabChanged(0)">
                    Voir le detail de l'ouvrage
                  </button><br>
                  <button mat-button color="warn" (click)="deleteOuvrageDuDevis(ouvrage.id)">
                    Effacer cet ouvrage
                  </button>
                  </div>

                </mat-menu>

                  </span>
                  </div>
                </div>
                <div class="container-cout" *ngFor="let cout of ouvrage.CoutDuDevis">
                  <div class="ouvrage-frais-chantier"
                       *ngIf="ouvrage.SousLotOuvrage && ouvrage.designation.startsWith('OuvrageHidden')">
                    <div class="detail-ouvrage-frais-chantier">
                      <span class="designation-ouvrage-frais-chantier-td">Id</span>
                      <span class="designation-ouvrage-frais-chantier">{{cout.id}}</span>
                    </div>
                    <div class="detail-ouvrage-frais-chantier">
                      <span class="designation-ouvrage-frais-chantier-td">Qte</span>
                      <mat-form-field appearance="legacy" [formGroup]="myFormGroup" id="quantity-cout2">
                        <input type="number" formControlName="quantityOuvrage" matInput required
                               [placeholder]="ouvrage.SousLotOuvrage.quantityOuvrage.toString()"
                               (ngModelChange)="quantityChange($event, ouvrage?.SousLotOuvrage, sublot, lotFraisDeChantier, prixOuvrage)">

                        <!--                             (keyup.enter)="quantityChange($event, ouvrage?.SousLotOuvrage, sublot, lot, prixOuvrage)">-->
                      </mat-form-field>
                    </div>


                    <div class="detail-ouvrage-frais-chantier" id="designation-cout2">
                      <span class="designation-ouvrage-frais-chantier-td">Désignation</span>
                      <span class="designation-ouvrage-frais-chantier">{{cout.designation}}</span>
                    </div>
                    <div class="detail-ouvrage-frais-chantier">
                      <span class="designation-ouvrage-frais-chantier-td">Bénéfice</span>
                      <!--                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.benefice}}</span>-->
                      <mat-form-field appearance="legacy" [formGroup]="formBAOuvrageHidden" style="width: 30px">
                        <input type="number" (keyup.enter)="beneficeChange(ouvrage.id)" formControlName="benefice"
                               matInput required
                               [placeholder]="ouvrage.benefice.toString()">
                      </mat-form-field>
                    </div>
                    <div class="detail-ouvrage-frais-chantier">
                      <span class="designation-ouvrage-frais-chantier-td">Aléas</span>
                      <!--                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.aleas}}</span>-->
                      <mat-form-field appearance="legacy" [formGroup]="formBAOuvrageHidden" style="width: 30px">
                        <input type="number" (keyup.enter)="aleasChange(ouvrage.id)" formControlName="aleas" matInput
                               required
                               [placeholder]="ouvrage.aleas.toString()">
                      </mat-form-field>
                    </div>
                    <div class="detail-ouvrage-frais-chantier">
                      <span class="designation-ouvrage-frais-chantier-td">Unité</span>
                      <span class="designation-ouvrage-frais-chantier">{{cout.unite}}</span>
                    </div>
                    <!--                  <div class="detail-ouvrage-frais-chantier">-->
                    <!--                    <span class="designation-ouvrage-frais-chantier-td">U/Ratio</span>-->
                    <!--                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.uRatio}}</span>-->
                    <!--                  </div>-->
                    <div class="detail-ouvrage-frais-chantier" *ngIf="cout.OuvrageCoutDuDevis">
                      <span class="designation-ouvrage-frais-chantier-td">Ratio</span>
                      <span class="designation-ouvrage-frais-chantier">{{cout.OuvrageCoutDuDevis.ratio}}</span>
                    </div>


                    <div class="detail-ouvrage-frais-chantier">
                      <span class="designation-ouvrage-frais-chantier-td">Total DS HT</span>
                      <span
                        class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixOuvrage | number: '1.2-2'}}
                        €</span>

                    </div>
                    <div class="detail-ouvrage-frais-chantier" *ngIf="ouvrage.CoutDuDevis">
                      <span class="designation-ouvrage-frais-chantier-td">PU DS HT </span>

                      <span *ngIf="ouvrage.CoutDuDevis.length >= 1"
                            class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixUniHT | number: '1.2-2'}}
                        €
                    </span>
                      <span *ngIf="ouvrage.CoutDuDevis.length === 0"
                            class="designation-ouvrage-frais-chantier">{{ouvrage.prix | number: '1.2-2'}}
                        €</span>


                    </div>
<!--                    <div class="detail-ouvrage-frais-chantier">-->
<!--                      <span class="designation-ouvrage-frais-chantier-td">Prix Equilibre HT</span>-->
<!--                      <span-->
<!--                        class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixEquiHT | number: '1.2-2'}}-->
<!--                        €</span>-->
<!--                    </div>-->
<!--                    <div class="detail-ouvrage-frais-chantier">-->
<!--                      <span class="designation-ouvrage-frais-chantier-td">Prix Calculé HT</span>-->
<!--                      <span-->
<!--                        class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixCalcHT | number: '1.2-2'}}-->
<!--                        €</span>-->
<!--                    </div>-->
                    <div class="detail-ouvrage-frais-chantier">
                      <span class="designation-ouvrage-frais-chantier-td">PU Vente HT </span>
                      <span
                        class="designation-ouvrage-frais-chantier">
                      <mat-form-field [formGroup]="myFormGroup" id="prix-arrondi-ouvrage-devis2">

                                            <input type="number" formControlName="quantityOuvrage" matInput required
                                                   placeholder="{{ouvrage.SousLotOuvrage.prixUniVenteHT.toString() | number: '1.2-2'}}"
                                                   (ngModelChange)="onPrixUnitaireCalculeHtChange($event, ouvrage.SousLotOuvrage)">
                                          </mat-form-field>
                    </span>
                      <!--                    <span-->
                      <!--                      class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixUniVenteHT | number: '1.2-2'}}-->
                      <!--                      €</span>-->
                    </div>
                    <div class="detail-ouvrage-frais-chantier">
                      <span class="designation-ouvrage-frais-chantier-td">Prix Vente HT</span>
                      <span
                        class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixVenteHT | number: '1.2-2'}}
                        €</span>
                    </div>
                    <div class="detail-ouvrage-frais-chantier">
                      <mat-icon [matMenuTriggerFor]="boutonOuv">more_vert</mat-icon>
                      <mat-menu #boutonOuv>
                        <div class="menuBoutonSl">
                          <button mat-button color="warn" (click)="deleteCout(cout.id,ouvrage.id)">
                            Effacer le composant
                          </button>
                        </div>
                        <!--                      <button mat-button color="primary" (click)="openDialogUpdateCout(coutDuDevis)">-->
                        <!--                        Modifier le composant-->
                        <!--                      </button>-->
                      </mat-menu>
                    </div>

                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>

      </div>
    </mat-tab>


    <mat-tab class="devis" label="Devis" *ngIf="lotFraisDeChantier !== undefined " id="tab2" >
      <ng-template mat-tab-label >
<!--        <button mat-raised-button  data-step="2" data-intro="Ici vous retrouverez la partie centrale de votre etude de prix !"  >-->
          Devis
<!--        </button>-->
      </ng-template>
      <form [formGroup]="form" (ngSubmit)="onSubmit()" [hidden]="!showForm">
        <!-- Formulaire avec champ de saisie et bouton de validation -->
        <mat-form-field appearance="outline" color="primary">
          <mat-label>Designation</mat-label>
          <input id="designationLotSousLot" matInput formControlName="designation" placeholder="Entrer le nom."
                 #aForm/>
        </mat-form-field>
        <button mat-flat-button type="submit">Valider</button>
      </form>
      <div class="container-frais-chantier">
        <div class="container-card-frais-chantier">
          <div class="text-frais-chantier">
            <h4 class="title-frais-chantier">Chiffrage du devis</h4>
            <p class="text-frais-chantier">Veuillez ajouter les lots, sous-lots et les ouvrages <br> que vous souhaitez
              afficher dans votre devis.
            </p>
          </div>


          <mat-card class="card">
            <mat-card-content>
              <div>
                <mat-card-subtitle>Débousé sec HT</mat-card-subtitle>
                <div>
                  <p>{{!this.devis.debourseSecTotal ? 0 : this.devis.debourseSecTotal | number : '1.2-2'}} €</p>
                </div>
                <mat-card-subtitle>Prix Equilibre HT</mat-card-subtitle>
                <div>
                  <p>{{!this.devis.prixEquiHT ? 0 : this.devis.prixEquiHT | number: '1.2-2'}} €</p>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="card">
            <mat-card-content>
              <div>
                <mat-card-subtitle>Bénéfice</mat-card-subtitle>
                <div>
                  <p>{{!this.devis.beneficeInEuro ? 0 : this.devis.beneficeInEuro  | number : '1.2-2'}} € </p>
                </div>
                <mat-card-subtitle>Aléas</mat-card-subtitle>
                <div>
                  <p>{{!this.devis.aleasInEuro ? 0 : this.devis.aleasInEuro | number: '1.2-2'}} €</p>
                </div>
              </div>
            </mat-card-content>
          </mat-card>


          <mat-card class="card">
            <mat-card-content>
              <div>
                <mat-card-subtitle>Prix Calculé</mat-card-subtitle>
                <div>
                  <p>{{!this.devis.prixCalcHT ? 0 : this.devis.prixCalcHT  | number : '1.2-2'}} € </p>
                </div>
                <mat-card-subtitle>Prix de Vente</mat-card-subtitle>
                <div>
                  <p>{{!this.devis.prixVenteHT ? 0 : this.devis.prixVenteHT | number: '1.2-2'}} €</p>
                </div>
              </div>
            </mat-card-content>
          </mat-card>


          <mat-card class="card">
            <mat-card-content>
              <div>
                <mat-card-subtitle>Bénéfice & Aléas en %</mat-card-subtitle>
                <div>
                  <p>{{!this.devis.beneficeAleasTotalPercent ? 0 : this.devis.beneficeAleasTotalPercent | number: '1.2-2'}}
                    %</p>
                </div>
                <mat-card-subtitle>Bénéfice & Aléas en €</mat-card-subtitle>
                <div>
                  <p>{{!this.devis.beneficeAleasTotal ? 0 : this.devis.beneficeAleasTotal | number: '1.2-2'}} €</p>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <div class="flex-row">
          <button class="button" mat-button color="primary" (click)="autoFocus();showForm = true; isLot=false">+ Créer
            un lot
          </button>
          <div>
            <button class="button" (click)="openDialogCreate(this.hiddenSousLotForOuvrageId)" mat-button
                    color="primary">+ Créer un ouvrage
            </button>
          </div>
          <div>
            <button class="button" (click)="this.createHiddenLotAndSousLotAndOvrage()" mat-button
                    color="primary">+ Créer un cout
            </button>
            <!--          <button class="button" (click)="this.openDialogCreateCout()" mat-raised-button color="primary" >Cout</button>-->
          </div>
        </div>

        <div class="container-lot" *ngFor="let lot of testLots">
          <div class="lot-frais-chantier" *ngIf="!lot.designation.startsWith('LotHidden')">
            <button class="btn" *ngIf="lot.SousLots && lot.SousLots.length"
                    (click)="setExpandedLotId(lot.id)">

              <span class="designation-sous-lot-frais-chantier"><mat-icon>expand_more</mat-icon>
                {{ lot.id | number }}</span>
            </button>
            <ng-container *ngIf="!isEditMode; else editModeTemplate">
              <span class="designation-lot-frais-chantier"
                    (dblclick)="isEditMode = true">{{lot.designation | titlecase}}</span>
            </ng-container>

            <ng-template #editModeTemplate>
              <input style="width: 100px;font-size: 26px;color: #00a9f4;" matInput type="text"
                     [(ngModel)]="lot.designation" (keyup.enter)="updateDesignationLot(lot,lot.id)">
            </ng-template>

            <!--            <span class="designation-lot-frais-chantier">{{ lot.designation | titlecase }}</span>-->
            <span class="designation-lot-frais-chantier">{{ lot.prix | number }} €</span>
            <mat-icon [matMenuTriggerFor]="boutonLOT">more_vert</mat-icon>
            <mat-menu #boutonLOT>
              <div class="menuBoutonSl">
                <button mat-button color="primary" *ngIf="lotFraisDeChantier"
                        (click)="openDialogLot(lot)">
                  Modifier ce lot
                </button>
                <button class="margin-top" mat-button color="primary" *ngIf="lotFraisDeChantier"
                        (click)="autoFocus(); isLot = true; curentLotId= lot.id">
                  Créer un sous-lot
                </button>
                <br>
                <button mat-button color="primary" *ngIf="lotFraisDeChantier"
                        (click)="createSousLotHiddenForOuvrageInLot(lot.id); isLot = true; curentLotId= lot.id">
                  Créer un ouvrage
                </button>
                <button class="margin-top" (click)="importOuvrageInLot(lot.id)" mat-button
                        color="primary">
                  <!--          <button (click)="openDialog();handleSousLotClick(sublot.id)" mat-menu-item class="buttonImport">-->
                  Importer un ouvrage
                </button>
                <br>
                <button mat-button color="primary" *ngIf="lotFraisDeChantier"
                        (click)="createHiddenSousLotAndOuvrageForCoutInLot(lot.id); isLot = true; curentLotId= lot.id">
                  Créer un cout
                </button>
                <button class="margin-top" mat-button color="primary" *ngIf="lotFraisDeChantier"
                        (click)="this.openDialogImportCouts(lot.id,null); isLot = true; curentLotId= lot.id">
                  Importer un cout
                </button>
                <br>
                <button mat-button color="warn" class="" *ngIf="lot"
                        (click)="deleteLot(lot.id)">
                  Effacer ce lot
                </button>
              </div>

            </mat-menu>
          </div>
          <div class="container-sous-lot-frais-chantier" *ngFor="let sublot of lot.SousLots">


            <div class="sous-lot-frais-chantier" *ngIf="!sublot.designation.startsWith('SousLotHidden')">
              <button class="btn">
                <mat-icon>expand_more</mat-icon>
                <span class="designation-sous-lot-frais-chantier">id {{ sublot.id | number }}</span>
              </button>

              <ng-container *ngIf="!isEditMode2; else editModeTemplate2">
                <span class="designation-sous-lot-frais-chantier"
                      (click)="isEditMode2 = true">{{sublot.designation | titlecase}}</span>
              </ng-container>

              <ng-template #editModeTemplate2>
                <input style="width: 100px;font-size: 26px;color: #00a9f4;" matInput type="text"
                       [(ngModel)]="sublot.designation" (keyup.enter)="updateDesignationSL(sublot,sublot.id)">
              </ng-template>

              <!--              <span-->
              <!--                class="designation-sous-lot-frais-chantier">{{ sublot.designation | uppercase }}</span>-->


              <span
                class="designation-sous-lot-frais-chantier">{{ sublot.prix | number: '1.2-2'}} €</span>
              <!--              <span class="designation-sous-lot-frais-chantier"> {{ sublot.prix | number }} €</span>-->
              <mat-icon [matMenuTriggerFor]="boutonSL">more_vert</mat-icon>
              <!--            </div>-->
              <!--          </div>-->


              <mat-menu class="" #boutonSL>
                <div class="menuBoutonSl">
                  <button (click)="openDialogSousLot(sublot);" mat-button
                          color="primary">
                    <!--          <button (click)="openDialog();handleSousLotClick(sublot.id)" mat-menu-item class="buttonImport">-->
                    Modifier ce sous-lot
                  </button>
                  <br>
                  <button (click)="openDialog(sublot.id);currentSousLotId = sublot.id" mat-button
                          color="primary">
                    <!--          <button (click)="openDialog();handleSousLotClick(sublot.id)" mat-menu-item class="buttonImport">-->
                    Importer un ouvrage
                  </button>
                  <button class="margin-top" (click)="openDialogCreate(sublot.id);currentSousLotId = sublot.id"
                          mat-button
                          color="primary">
                    <!--          <button (click)="openDialog();handleSousLotClick(sublot.id)" mat-menu-item class="buttonImport">-->
                    Creer un ouvrage
                  </button>
                  <br>
                  <button (click)="createHiddenOuvrageForCoutInSousLot(sublot.id);currentSousLotId = sublot.id"
                          mat-button
                          color="primary">
                    <!--          <button (click)="openDialog();handleSousLotClick(sublot.id)" mat-menu-item class="buttonImport">-->
                    Creer un cout
                  </button>
                  <button class="margin-top" mat-button color="primary" *ngIf="lotFraisDeChantier"
                          (click)="this.openDialogImportCouts(null,sublot.id);  currentSousLotId= sublot.id">
                    Importer un cout
                  </button>
                  <br>

                  <button mat-button color="warn" *ngIf="lotFraisDeChantier"
                          (click)="deleteSousLot(sublot.id)">
                    <!--                  (click)="handleSousLotClick(sublot.id); currentLot = lot; deleteSousLot(sublot.id)">-->
                    Effacer ce sous-lot
                  </button>
                </div>


              </mat-menu>
            </div>

            <div *ngFor="let ouvrage of sublot.OuvrageDuDevis"
                 [hidden]="hiddenChildren.get(sublot.id)">
              <div class="container-ouvrage-frais-chantier" *ngIf="!ouvrage.designation.startsWith('OuvrageHidden')">
                <div class="ouvrage-frais-chantier" *ngIf="ouvrage.SousLotOuvrage">
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Id</span>
                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.id}}</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Qte</span>
                    <mat-form-field appearance="legacy" [formGroup]="myFormGroup" id="quantity-ouvrage-frias">
                      <input type="number" formControlName="quantityOuvrage" matInput required
                             [placeholder]="ouvrage.SousLotOuvrage.quantityOuvrage.toString()"
                             (ngModelChange)="quantityChange($event, ouvrage?.SousLotOuvrage, sublot, lot, prixOuvrage)">
                      <!--                             (keyup.enter)="quantityChange($event, ouvrage?.SousLotOuvrage, sublot, lot, prixOuvrage)">-->
                    </mat-form-field>
                  </div>


                  <div class="detail-ouvrage-frais-chantier" id="designation-ouvrage-devis">
                    <span class="designation-ouvrage-frais-chantier-td">Désignation</span>
                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.designation}}</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Bénéfice</span>
                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.benefice}}</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Aléas</span>
                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.aleas}}</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Unité</span>
                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.unite}}</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">U/Ratio</span>
                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.uRatio}}</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Rendement</span>
                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.ratio}}</span>
                  </div>


                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Total DS HT</span>
                    <span
                      class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixOuvrage | number: '1.2-2'}}
                      €</span>

                  </div>
                  <div class="detail-ouvrage-frais-chantier" *ngIf="ouvrage.CoutDuDevis">
                    <span class="designation-ouvrage-frais-chantier-td">PU DS HT </span>

                    <span *ngIf="ouvrage.CoutDuDevis.length >= 1"
                          class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixUniHT | number: '1.2-2'}}
                      €
                    </span>
                    <span *ngIf="ouvrage.CoutDuDevis.length === 0"
                          class="designation-ouvrage-frais-chantier">{{ouvrage.prix | number: '1.2-2'}}
                      €</span>


                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Prix Equilibre HT</span>
                    <span
                      class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixEquiHT | number: '1.2-2'}}
                      €</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Prix Calculé HT</span>
                    <span
                      class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixCalcHT | number: '1.2-2'}}
                      €</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">PU Vente HT </span>
                    <span
                      class="designation-ouvrage-frais-chantier">
                      <mat-form-field [formGroup]="myFormGroup" id="prix-arrondi-devis">
                                            <input type="number" formControlName="quantityOuvrage" matInput required
                                                   placeholder="{{ouvrage.SousLotOuvrage.prixUniVenteHT.toString() | number: '1.2-2'}}"
                                                   (ngModelChange)="onPrixUnitaireCalculeHtChange($event, ouvrage.SousLotOuvrage)">
                                          </mat-form-field>
                    </span>

                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Prix Vente HT</span>
                    <span
                      class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixVenteHT | number: '1.2-2'}}
                      €</span>
                  </div>
                  <div>
                  <span class="designation-ouvrage-frais-chantier">
                  <mat-icon [matMenuTriggerFor]="boutonOuv">more_vert</mat-icon>
                <mat-menu #boutonOuv>
                  <div class="menuBoutonSl">
                    <button mat-button color="primary" routerLink="/sousDetailPrix/{{ouvrage.id}}"
                            (click)="onTabChanged(1)">
                    Voir le detail de l'ouvrage
                  </button>
                    <br>
                  <button mat-button color="warn" (click)="deleteOuvrageDuDevis(ouvrage.id)">
                    Effacer cet ouvrage
                  </button>
                  </div>

                </mat-menu>

                  </span>
                  </div>
                </div>
              </div>

              <!--test-->
              <div class="container-cout" *ngFor="let cout of ouvrage.CoutDuDevis">
                <div class="ouvrage-frais-chantier"
                     *ngIf="ouvrage.SousLotOuvrage && ouvrage.designation.startsWith('OuvrageHidden')">
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Id</span>
                    <span class="designation-ouvrage-frais-chantier">{{cout.id}}</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Qte</span>
                    <mat-form-field appearance="legacy" [formGroup]="myFormGroup" id="quantity-cout">
                      <input type="number" formControlName="quantityOuvrage" matInput required
                             [placeholder]="ouvrage.SousLotOuvrage.quantityOuvrage.toString()"
                             (ngModelChange)="quantityChange($event, ouvrage?.SousLotOuvrage, sublot, lot, prixOuvrage)">
                      <!--                             (keyup.enter)="quantityChange($event, ouvrage?.SousLotOuvrage, sublot, lot, prixOuvrage)">-->
                    </mat-form-field>
                  </div>


                  <div class="detail-ouvrage-frais-chantier" id="designation-cout">
                    <span class="designation-ouvrage-frais-chantier-td">Désignation</span>
                    <span class="designation-ouvrage-frais-chantier">{{cout.designation}}</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Bénéfice</span>
                    <!--                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.benefice}}</span>-->
                    <mat-form-field appearance="legacy" [formGroup]="formBAOuvrageHidden" style="width: 30px">
                      <input type="number" (keyup.enter)="beneficeChange(ouvrage.id)" formControlName="benefice"
                             matInput required
                             [placeholder]="ouvrage.benefice.toString()">
                    </mat-form-field>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Aléas</span>
                    <!--                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.aleas}}</span>-->
                    <mat-form-field appearance="legacy" [formGroup]="formBAOuvrageHidden" style="width: 30px">
                      <input type="number" (keyup.enter)="aleasChange(ouvrage.id)" formControlName="aleas" matInput
                             required
                             [placeholder]="ouvrage.aleas.toString()">
                    </mat-form-field>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Unité</span>
                    <span class="designation-ouvrage-frais-chantier">{{cout.unite}}</span>
                  </div>
                  <!--                  <div class="detail-ouvrage-frais-chantier">-->
                  <!--                    <span class="designation-ouvrage-frais-chantier-td">U/Ratio</span>-->
                  <!--                    <span class="designation-ouvrage-frais-chantier">{{ouvrage.uRatio}}</span>-->
                  <!--                  </div>-->
                  <div class="detail-ouvrage-frais-chantier" *ngIf="cout.OuvrageCoutDuDevis">
                    <span class="designation-ouvrage-frais-chantier-td">Ratio</span>
                    <span class="designation-ouvrage-frais-chantier">{{cout.OuvrageCoutDuDevis.ratio}}</span>
                  </div>


                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Total DS HT</span>
                    <span
                      class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixOuvrage | number: '1.2-2'}}
                      €</span>

                  </div>
                  <div class="detail-ouvrage-frais-chantier" *ngIf="ouvrage.CoutDuDevis">
                    <span class="designation-ouvrage-frais-chantier-td">PU DS HT </span>

                    <span *ngIf="ouvrage.CoutDuDevis.length >= 1"
                          class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixUniHT | number: '1.2-2'}}
                      €
                    </span>
                    <span *ngIf="ouvrage.CoutDuDevis.length === 0"
                          class="designation-ouvrage-frais-chantier">{{ouvrage.prix | number: '1.2-2'}}
                      €</span>


                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Prix Equilibre HT</span>
                    <span
                      class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixEquiHT | number: '1.2-2'}}
                      €</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Prix Calculé HT</span>
                    <span
                      class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixCalcHT | number: '1.2-2'}}
                      €</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">PU Vente HT </span>
                    <span
                      class="designation-ouvrage-frais-chantier">
                      <mat-form-field [formGroup]="myFormGroup" id="prix-arrondi-ouvrage-devis">
                                            <input type="number" formControlName="quantityOuvrage" matInput required
                                                   placeholder="{{ouvrage.SousLotOuvrage.prixUniVenteHT.toString() | number: '1.2-2'}}"
                                                   (ngModelChange)="onPrixUnitaireCalculeHtChange($event, ouvrage.SousLotOuvrage)">
                                          </mat-form-field>
                    </span>
                    <!--                    <span-->
                    <!--                      class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixUniVenteHT | number: '1.2-2'}}-->
                    <!--                      €</span>-->
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <span class="designation-ouvrage-frais-chantier-td">Prix Vente HT</span>
                    <span
                      class="designation-ouvrage-frais-chantier">{{ouvrage.SousLotOuvrage.prixVenteHT | number: '1.2-2'}}
                      €</span>
                  </div>
                  <div class="detail-ouvrage-frais-chantier">
                    <mat-icon [matMenuTriggerFor]="boutonOuv">more_vert</mat-icon>
                    <mat-menu #boutonOuv>
                      <div class="menuBoutonSl">
                        <button mat-button color="warn" (click)="deleteCout(cout.id,ouvrage.id)">
                          Effacer le composant
                        </button>
                      </div>
                      <!--                      <button mat-button color="primary" (click)="openDialogUpdateCout(coutDuDevis)">-->
                      <!--                        Modifier le composant-->
                      <!--                      </button>-->
                    </mat-menu>
                  </div>

                </div>
              </div>
            </div>

          </div>


        </div>


      </div>

    </mat-tab>


    <mat-tab label="Paramètre de chantier" *ngIf="lotFraisDeChantier !== undefined" id="tab3">
      <ng-template mat-tab-label >
<!--        <button mat-raised-button  data-step="3" data-intro="Ici vous retrouverez les paramètres de chantier avec un récapitulatif de certaine donnée liée a votre étude de prix ainsi que les réglages des frais généraux !"  >-->
          Paramètre de chantier
<!--        </button>-->
      </ng-template>
      <div class="bigContainerParams">
        <div class="ContainerParamsFraisDevis">
          <mat-card class="cardParams">
            <mat-card-header>
              <mat-card-title>Frais de chantier</mat-card-title>

            </mat-card-header>
            <hr>
            <mat-card-content>
              <div class="containerParams">
                <div class="paramsSub">
                  <div class="itemsParams">
                    <mat-card-subtitle>Prix de vente</mat-card-subtitle>
                    <p>{{!this.fraisDeChantier.prixVenteHT ? 0 : this.fraisDeChantier.prixVenteHT | number : '1.2-2'}}
                      €</p>
                  </div>
                  <div class="itemsParams">
                    <mat-card-subtitle>Total DBS</mat-card-subtitle>
                    <p>{{!this.lotFraisDeChantier.prix ? 0 : this.lotFraisDeChantier.prix | number : '1.2-2'}} €</p>
                  </div>
                </div>
                <!--                <div class="paramsSub">-->
                <!--                  <div class="itemsParams">-->
                <!--                    <mat-card-subtitle>Total</mat-card-subtitle>-->
                <!--                    <p>{{!this.lotFraisDeChantier.prix ? 0 : this.lotFraisDeChantier.prix | number : '1.2-2'}} €</p>-->
                <!--                  </div>-->
                <!--                  <div class="itemsParams">-->
                <!--                    <mat-card-subtitle>Bénéfice & Aléas</mat-card-subtitle>-->
                <!--                    <p *ngIf="!this.resultAleasFraisDeChantier || !this.resultBeneficeFraisDeChantier; else other ">0 %</p>-->
                <!--                    <ng-template #other>{{this.resultAleasFraisDeChantier + this.resultBeneficeFraisDeChantier  | number : '1.2-2'}} %</ng-template>-->
                <!--                  </div>-->
                <!--                </div>-->

              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="cardParams">
            <mat-card-header>
              <mat-card-title>Devis</mat-card-title>
            </mat-card-header>
            <hr>
            <mat-card-content>
              <div class="containerParams">
                <div class="paramsSub">
                  <div class="itemsParams">
                    <mat-card-subtitle>Bénéfice</mat-card-subtitle>
                    <p>{{!this.devis.moyenneBenefice ? 0 : this.devis.moyenneBenefice | number : '1.2-2'}} %</p>
                  </div>
                  <div class="itemsParams">
                    <mat-card-subtitle>Aléas</mat-card-subtitle>
                    <p>{{!this.devis.moyenneAleas ? 0 : this.devis.moyenneAleas | number : '1.2-2' }} %</p>
                  </div>
                </div>
                <div class="paramsSub">
                  <div class="itemsParams">
                    <mat-card-subtitle>Total</mat-card-subtitle>
                    <p>{{!this.devis.debourseSecTotal ? 0 : this.devis.debourseSecTotal | number : '1.2-2'}} €</p>
                  </div>
                  <div class="itemsParams">
                    <mat-card-subtitle>Bénéfice & Aléas</mat-card-subtitle>
                    <p>{{!this.devis.moyenneBeneficeAleas ? 0 : this.devis.moyenneBeneficeAleas  | number : '1.2-2'}}
                      %</p>


                  </div>
                </div>

              </div>

            </mat-card-content>
          </mat-card>
        </div>
        <div class="ContainerParamsFraisDevis">
          <mat-card class="cardParams">
            <mat-card-header>
              <mat-card-title>Total</mat-card-title>
            </mat-card-header>
            <hr>
            <mat-card-content>
              <div class="containerParams">
                <div class="paramsSub">
                  <div class="itemsParams">
                    <mat-card-subtitle>Total Dépense</mat-card-subtitle>
                    <p>{{!this.devis.totalDepense ? 0 : this.devis.totalDepense | number : '1.2-2'}} €</p>
                  </div>
                  <div class="itemsParams">
                    <mat-card-subtitle>Cout Total</mat-card-subtitle>
                    <p>{{!this.devis.coutTotal ? 0 : this.devis.coutTotal | number : '1.2-2'}} €</p>
                  </div>
                </div>
                <div class="paramsSub">
                  <div class="itemsParams">
                    <mat-card-subtitle>Bénefice</mat-card-subtitle>
                    <p>{{!this.devis.moyenneBenefice ? 0 : this.devis.moyenneBenefice | number : '1.2-2'}} %</p>
                  </div>
                  <div class="itemsParams">
                    <mat-card-subtitle>Aléas</mat-card-subtitle>
                    <p>{{!this.devis.moyenneAleas ? 0 : this.devis.moyenneAleas | number : '1.2-2' }} %</p>
                  </div>
                  <div class="itemsParams">
                    <mat-card-subtitle>Bénéfice & Aléas</mat-card-subtitle>
                    <p>{{!this.devis.moyenneBeneficeAleas ? 0 : this.devis.moyenneBeneficeAleas  | number : '1.2-2'}}
                      %</p>
                  </div>

                </div>

                <div class="paramsSub">
                  <div class="itemsParams">

                    <mat-card-subtitle>Frais généraux (
                      <mat-form-field style="width: 135px;text-align: center" appearance="legacy"
                                      id="input-fraisGeneraux">
                        <input (blur)="this.updateFraisGeneraux($event)" formControlName="percentFraisGeneraux"
                               type="number" matInput
                               [placeholder]="this.myFormFraisGeneraux.get('percentFraisGeneraux')?.value">
                      </mat-form-field>
                      ) %
                    </mat-card-subtitle>
                    <p>{{!this.devis.fraisGeneraux ? 0 : this.devis.fraisGeneraux | number : '1.2-2'}} €</p>
                  </div>
                  <div class="itemsParams">
                    <mat-card-subtitle>Coéfficient d'équilibre</mat-card-subtitle>
                    <p>{{!this.devis.coeffEquilibre ? 0 : this.devis.coeffEquilibre  | number : '1.2-2'}}</p>
                  </div>

                </div>

              </div>

            </mat-card-content>
          </mat-card>
        </div>

      </div>

      <div *ngIf="lotFraisDeChantier !== undefined">
        <!--      <p>Benefice theorique moyenne des benefices des ouvrages des lot du devis valeur en %, valeur en E </p>-->
        <!--      <h2>{{this.resultBeneficeLots}}</h2>-->
        <!--      <p>Aleas theorique moyenne des aleas des ouvrages des lot des devis, valeur en %, valeur en E </p>-->
        <!--      <h2>{{this.resultAleasLots}}</h2>-->
        <!--      <p>Benefice theorique moyenne des benefices des ouvrages du Frais de chantier valeur en %, valeur en E </p>-->
        <!--      <h2>{{this.resultBeneficeFraisDeChantier}}</h2>-->
        <!--      <p>Aleas theorique moyenne des aleas des ouvrages du Frais de chantier, valeur en %, valeur en E </p>-->
        <!--      <h2>{{this.resultAleasFraisDeChantier}}</h2>-->
        <!--      <p>Frais de chantier total de l'onglet frais de chantier = </p>-->
        <!--      <h2>{{lotFraisDeChantier.prix}}</h2>-->
        <!--      <p>Frais generaux 20% total deboursés sec + frais de chantier</p>-->
        <!--      <h2>{{fraisGeneraux()}}</h2>-->
        <!--      <p> total deboursés sec (total devis) </p>-->
        <!--      <h2>{{prixDevis}}</h2>-->
        <!--      <p>total depense total debousés sec + frais de chantier</p>-->
        <!--      <h2> {{totalDepense()}}</h2>-->
        <!--      <p>cout total total debourses sec + frais de chantier + frais generaux</p>-->
        <!--      <h2>{{coutTotal()}}</h2>-->
        <!--      <p> coefficient d'equilibre cout total / total deboursé sec /</p>-->
        <!--      <h2>{{coefEquilibre()}}</h2>-->
      </div>
    </mat-tab>


    <mat-tab disabled label="Export" *ngIf="lotFraisDeChantier !== undefined && devis !== undefined">
      <ng-template mat-tab-label>
        <button mat-raised-button color="primary" (click)="dynamicDownloadTxt()" data-step="4" data-intro="A la cloture de votre etude de prix vous pouvez decider de l'exporter au format CSV en cliquant simplement ici !" >
          Exporter l'étude de prix au format CSV
        </button>
        <button mat-flat-button class="" style="color: #00a9f4" (click)="startIntro()">Help</button>

      </ng-template>
    </mat-tab>


  </mat-tab-group>


</ng-template>
